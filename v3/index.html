<!doctype html><html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="frontend/img/favicon.ico" type="image/x-icon">
  <title>ECAM v3 (development)</title>

  <!--load backend-->
    <script src="backend/structure.js"></script>
    <script src="backend/global.js"></script>
    <script src="backend/info.js"></script>
    <script src="backend/countries.js"></script>
    <script src="backend/gwp_reports.js"></script>
    <script src="backend/constants.js"></script>
    <script src="backend/substages.js"></script>
    <script src="backend/tables.js"></script>
    <script src="backend/units.js"></script>
    <script src="backend/recommendations.js"></script>
    <script src="backend/exceptions.js"></script>
    <script src="backend/normalization.js"></script>
    <script src="backend/formulas.js"></script>
    <script src="backend/questions.js"></script>
    <script src="backend/tier_A.js"></script>

    <!--v2
    <script src="dataModel/unfccc.js"></script>

    <script src="dataModel/level3variables.js"></script>
    <script src="dataModel/level2only.js"></script>
    <script src="dataModel/refValues.js"></script>
    <script src="dataModel/estimations.js"></script>

    <script src="dataModel/sumable_magnitudes.js"></script>

    <script src="utils.js"></script>
    <script src="graphs.js"></script>
    <script src="main_menu.js"></script>
    -->
  <!--/load backend-->

  <!--load frontend-->
    <!--load css-->
    <link rel="stylesheet" href="frontend/css/css.css">
    <link rel="stylesheet" href="frontend/css/css_components.css">

    <!--string prettify for descriptions (mainly for CO2, N2O, CH4 subindexes)-->
    <script src="frontend/js/prettify.js"></script>

    <!--capitalize first letter of a string-->
    <script src="frontend/js/ucfirst.js"></script>

    <!--libs-->
      <!--google charts-->
      <script src="frontend/js/charts/loader.js"></script>
      <!--vue
        development version, includes helpful console warnings
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="frontend/vue-dev.js"></script>
        production version, optimized for size and speed
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>
        <script src="frontend/vue-pro.js"></script>
      -->
      <script src="frontend/vue-dev.js"></script>
    <!--/libs-->

    <!--load language tags-->
    <script src="frontend/languages/translate.js"></script>

    <!--load frontend utils-->
    <script src="frontend/js/tips.js"></script>
    <script src="frontend/js/format.js"></script>
  <!--/load frontend-->
</head><body>

<!--loading indicator-->
<div id=loading_container style="text-align:center;font-size:x-large">
  <div v-if="!ready">loading ecam tool...</div>
</div>

<!--ecam all views-->
<div id=ecam>

  <!--ecam logo COMPONENT-->
  <div id="ecam-logo">
    <!--3 lines menu symbol "burger"-->
    <div id=burger onclick="event.stopPropagation();sidebar.visible^=1">
      &#9776;
    </div>

    <!--logo-->
    <div id=logo_container onclick="ecam.show('index')">
      <div id=logo>ECAM</div>
      <div>
        {{translate('navbar_title')}}
      </div>
    </div>

    <!--version-->
    <div style="font-family:monospace">
      <a href="//github.com/icra/ecam" target=_blank>
        {{version}}
      </a>
    </div>

    <!--temporal button-->
    <div>
      <button onclick="linear_menu.visible^=true">
        view/hide<br>linear menu
      </button>
    </div>

    <!--language-->
    <div id=lang>
      <!--current language-->
      <img :src=`frontend/img/flags/${Languages.current}.png`>

      <!--all languages-->
      <div id=select>
        <div
          v-for="lang in Languages.list"
          :lang="lang"
          @click="Languages.current=lang"
        >
          <img :src=`frontend/img/flags/${lang}.png`>
          {{lang}}
        </div>

        <!--null (only language tags)-->
        <div lang=null @click="Languages.current='null'">
          <img src="frontend/img/flags/null.png">
          null (tags only)
        </div>

        <!--language problem finder-->
        <div :lang="Languages.current">
          <a href="" style=color:blue>
            language debugging tool
          </a>
        </div>
      </div>
    </div>
  </div>

  <!--sidebar COMPONENT-->
  <div id=sidebar v-if="visible" :style="`top:${get_height()}px`">
    <div class="header flex" style="padding:5px;justify-content:space-between">
      <div>{{translate("sidebar_mainMenu")}}</div>
      <div>{{Global.General.Name}}          </div>
    </div>

    <!--new open save clear-->
    <div class=tab_buttons>
      <button class=left onclick="" disabled>
        {{translate('new')}}
      </button>
      <button class=middle onclick="" disabled>
        {{translate('open')}}
      </button>
      <button class=right onclick="" disabled>
        {{translate('save')}}
      </button>
      <input type="file" id="loadfile" accept=".json"
        onchange="loadFile(event)" style="display:none">
    </div>

    <!--sections-->
    <ul>
      <!--general info to tier A section-->
      <li class=section>
        <div class=header>{{translate('main')}}</div>
        <ul>
          <li class=item><a onclick="ecam.show('get_started')">  {{translate('getStarted_general_info')}}</a>
          <li class=item><a onclick="ecam.show('configuration')">{{translate('configuration')          }}</a>
          <li class=item><a onclick="ecam.show('population')">   {{translate('population')             }}</a>
          <li class=item><a onclick="ecam.show('tier_a')">       {{translate('quick_assessment')       }}</a>
        </ul>
      </li>

      <!--tier B section-->
      <li class=section>
        <div class=header>{{translate('energy_performance')}}</div>
        <ul>
          <li
            class=item
            v-for="l1 in Structure.filter(s=>!s.sublevel).filter(s=>Global.Configuration.ActiveStages[s.alias])"
          >
            <a @click="go_to(l1.level)" :style=`color:${l1.color}`>
              {{translate(l1.level)}}
            </a>

            <ul>
              <li
                class=item-l2
                v-for="l2 in Structure
                              .filter(s=>(s.sublevel && s.level==l1.level))
                              .filter(s=>Global.Configuration.ActiveStages[s.alias])"
              >
                <a @click="go_to(l2.level, l2.sublevel)"
                  :style=`color:${l1.color}`
                >
                  {{translate(l2.sublevel)}}
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </li>

      <!--summaries ghg and energy section-->
      <li class=section>
        <div class=header>{{translate('summaries')}}</div>
        <ul>
          <li class=item><a onclick="ecam.show('summary_ghg')"> {{translate('ghg_summary')      }}</a>
          <li class=item><a onclick="ecam.show('summary_nrg')"> {{translate('nrg_summary')      }}</a>
          <li class=item><a onclick="TODO">   {{translate('unfccc_categories')}} TODO</a>
          <li class=item><a onclick="TODO">   {{translate('all_substages')    }} TODO </a>
          <li class=item><a onclick="TODO">   {{translate('all_inputs')       }} TODO </a>
          <li class=item><a onclick="TODO">   {{translate('all_outputs')      }} TODO </a>
          <li class=item><a onclick="TODO">   {{translate('all_ccvv')         }} TODO </a>
          <li class=item><a onclick="TODO">   {{translate('All questions')    }} TODO </a>
          <li class=item><a onclick="TODO">   {{translate('all_constants')    }} TODO </a>
          <li class=item><a onclick="TODO">   {{translate('all_benchmarks')   }} TODO </a>
        </ul>
      </li>

      <!--other section-->
      <li class=section>
        <div class=header>{{translate('other')}}</div>
        <ul>
          <li class=item><a onclick="ecam.show('opportunities')"> {{translate("opportunities") }}</a>
          <li class=item><a onclick="ecam.show('')">              {{translate('sidebar_export')}} TODO</a>
          <li class=item><a onclick="ecam.show('')">              {{translate('Sankey diagram')}} TODO</a>
          <li class=item><a onclick="ecam.show('')">              {{translate('dev')}}            TODO</a>
        </ul>
      </li>

      <!--support section-->
      <li class=section>
        <div class=header>{{translate('support')}}</div>
        <ul>
          <li class=item><a onclick="ecam.show('help')">{{translate('help')}}</a>
          <li class=item><a onclick="ecam.show('about')">{{translate('about')}}</a>
        </ul>
      </li>
    </ul>

    <!--for development-->
    <div>
      <button @click=visible^=1>close</button>
    </div>
  </div>

  <!--linear menu COMPONENT-->
  <div id=linear-menu v-if="visible" class=flex>
    <!--linear general info-->
    <div onclick="ecam.show('get_started')">
      <div>
        <a style="color:inherit">
          {{translate('getStarted_general_info')}}
        </a>
      </div>
      <img
        :class="`l1 ${current_view=='get_started'?'selected':''}`"
        src=frontend/img/getStarted.png
        @mousemove="caption.show($event, translate('getStarted_general_info'))"
        @mouseout="caption.hide()"
      >
    </div>

    <!--linear configuration-->
    <div onclick="ecam.show('configuration')">
      <div>
        <a style="color:inherit">
          {{translate('configuration')}}
        </a>
      </div>
      <img
        :class="`l1 ${current_view=='configuration'?'selected':''}`"
        src=frontend/img/dashboard.png
        @mousemove="caption.show($event, translate('configuration'))"
        @mouseout="caption.hide()"
      >
    </div>

    <!--linear population-->
    <div onclick="ecam.show('population')">
      <div>
        <a style="color:inherit">
          {{translate('population')}}
        </a>
      </div>
      <img
        :class="`l1 ${current_view=='population'?'selected':''}`"
        src=frontend/img/inhabitants.png
        @mousemove="caption.show($event, translate('population'))"
        @mouseout="caption.hide()"
      >
    </div>

    <!--linear tier A-->
    <div onclick="ecam.show('tier_a')">
      <div>
        <a style="color:inherit" v-html="translate('tier_A')"></a>
      </div>
      <img
        :class="`l1 ${current_view=='tier_a'?'selected':''}`"
        src=frontend/img/birds.png
        @mousemove="caption.show($event, translate('tier_A'))"
        @mouseout="caption.hide()"
      >
    </div>

    <!--linear tier B-->
    <div>
      <div>
        <span style="color:inherit"
          v-html="translate('tier_B')"
        ></span>
      </div>
      <img v-for="l2 in Structure.filter(s=>s.sublevel)"
        :class="`l2 ${is_tier_b_selected(l2.level,l2.sublevel)?'selected':''}`"
        :stage="l2.alias"
        @mousemove="caption.show($event, translate(l2.sublevel))"
        @mouseout="caption.hide()"
        :src="`frontend/img/${l2.alias}${Global.Configuration.ActiveStages[l2.alias]?'':'-off'}.png`"
        @click="go_to(l2.level,l2.sublevel)"
      >
    </div>

    <!--linear summaries and opps-->
    <div class=flex>
      <!--summaries button-->
      <div>
        <div>
          <span style="color:inherit">
            {{translate('summaries')}}
          </span>
        </div>
        <img
          :class="`l1 ${current_view=='summary_ghg'?'selected':''}`"
          src=frontend/img/sources.png
          onclick="ecam.show('summary_ghg')"
          @mousemove="caption.show($event, translate('ghg_summary'))"
          @mouseout="caption.hide()"
        >
        <img
          :class="`l1 ${current_view=='summary_nrg'?'selected':''}`"
          src=frontend/img/energy.png
          onclick="ecam.show('summary_nrg')"
          @mousemove="caption.show($event, translate('nrg_summary'))"
          @mouseout="caption.hide()"
        >
      </div>

      <!--opportunities button-->
      <div>
        <div>
          <a style="color:inherit">
            {{translate('opportunities')}}
          </a>
        </div>
        <img
          :class="`l1 ${current_view=='opportunities'?'selected':''}`"
          src=frontend/img/opps.png
          onclick="ecam.show('opportunities')"
          @mousemove="caption.show($event, translate('opportunities'))"
          @mouseout="caption.hide()"
        >
      </div>
    </div>
  </div>

  <!--caption COMPONENT-->
  <div id=caption v-html="text" :style="visible?'':'display:none'"></div>

  <!--index VIEW-->
  <div id=index v-if="visible">
    <div id=content>
      <!--index title-->
      <div class="width_50">
        <h1 class="blue_h1" style=padding-bottom:0px>
          {{translate("a_toolkit_for_utilities")}}
        </h1>
        <h1 class="green_h1" style=font-size:32px>
          {{translate("assess_your_utility")}}
        </h1>

        <!--index text-->
        <h4 style=font-size:18px;color:#58595b>
          {{translate("index_description")}}
        </h4>
        <h4 style=font-size:18px;color:#58595b>
          {{translate("ecam_is_a_free_and")}}
          <a target=_blank href=//github.com/icra/ecam>
            {{translate("open_source")}}
          </a>
          {{translate("tool_developed_as_part_of_the")}}
          <a target=_blank href=//wacclim.org/>
            {{translate("wacclim_project")}}
          </a>
        </h4>
        <h4 style=font-size:18px;color:#58595b>
          {{translate("first_time_using_ecam")}}
          <a onclick="ecam.show('help')">
            {{translate("here")}}.
          </a>
        </h4>

        <!--MENU BUTTONS-->
        <div style="padding:1em 0">
          <div class=flex id=menu_buttons>
            <!--new-->
            <div>
              <button class="button add" onclick="newSystem()" style=margin-left:0 disabled>
                {{translate('new')}}
              </button>
            </div>

            <!--load/open-->
            <div>
              <input type=file
                id=loadfile
                accept=".json"
                onchange="loadFile(event)"
                style=display:none
              >
              <button class="button edit" disabled
                onclick=document.getElementById('loadfile').click()>
                {{translate('open')}}
              </button>
            </div>

            <!--save-->
            <div>
              <button class="button save" onclick=saveToFile() disabled>
                {{translate('save_as')}}
                <span id=save_as_filename>
                  "{{Global.General.Name}}.json"
                </span>
              </button>
            </div>

            <!--next-->
            <div>
              <button class="button next"
                onclick="event.stopPropagation();ecam.show('get_started')"
              >
                {{translate('next')}}
              </button>
            </div>
          </div>
        </div>

        <br><br>

        <div>
          <a class="blue_links" href="http://wacclim.org/" target=_blank>
            WaCCliM
          </a> -
          <a class="blue_links" onclick="ecam.show('about')">
            {{translate("about")}}
          </a> -
          <a class="blue_links" onclick="ecam.show('help')">
            {{translate("help")}}
          </a> -
          <a class="blue_links" href=mailto:wacclim@giz.de target=_blank>
            {{translate("contact")}}: wacclim@giz.de
          </a>
        </div>

        <img class="license_img license_img-big" src="frontend/img/CC_license_small.png" alt=""><br>

        {{translate("ecam_by_iwa_giz_icra")}}
        <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
          {{translate("creative_commons_attr")}}
        </a>.
        <div style=font-size:smaller>
          {{translate("wacclim_is_part_of_IKI")}}
        </div>
      </div>

      <!--picture-->
      <div class="width_50" style="padding:0;text-align:center">
        <img class="img_resp" src="frontend/img/diagram.png">
      </div>
    </div>

    <!--logos-->
    <div>
      <footer id=footer>
        <img
          id=logo-wacclim
          src="frontend/img/logo-wacclim_big.png"
          style="height:120px;margin:auto"
        >
      </footer>
      <div style="background:white;text-align:left;padding:0em 10em;margin-top:50px;">
        <img src="frontend/img/logos.png">
      </div>
    </div>
  </div>

  <!--about VIEW-->
  <div id=about v-if="visible">
    <h1 style=text-align:center>
      <span onclick="ecam.show('index')">{{translate('start')}}</span>
      &rsaquo;
      {{translate('about')}}
    </h1>

    <!--paragraph-->
    <div style=margin:auto;max-width:40%;text-align:justify;line-height:2em>
      <p>
        The web interface and new features for the ECAM tool were developed by
        <a target=_blank href='http://www.icra.cat/'>ICRA</a>,
        <a target=_blank href='http://www.iwa-network.org'>IWA</a>, and
        <a target=_blank href='https://www.giz.de/en/html/index.html'>GIZ</a> under the
        <a target=_blank href='http://www.iwa-network.org/WaCCliM/es/'>WaCCliM project</a>.
      </p>

      <p>
        This tool was first developed within the project in 2015 as an Excel tool by the consortium Urban Water Commons
        (<a target=_blank href='http://www.lnec.pt/pt/'>LNEC</a> and
        <a target=_blank href='http://www.ita.upv.es/index-es.php'>ITA, Universitat Politècnica de València)</a> in collaboration with
        <a target=_blank href='http://www.cobaltwater-global.com/'>Cobalt Water Global</a>.
        The Excel tool laid the foundation and basic equations for the web-tool.
      </p>

      <p>
        WaCCliM project is part of the <a target=_blank href="https://www.international-climate-initiative.com/">International Climate Initiative (IKI)</a>.
        The German Federal Ministry for the Environment, Nature Conservation,
        Building and Nuclear Safety (BMU) supports this initiative on the basis of a decision adopted by the German Bundestag.
      </p>

      <p>
        This software is free and <a href=https://github.com/icra/ecam>open source</a>.
      </p>

      <p>
        2015-{{(new Date()).getFullYear()}} <a href='license.txt'>{{translate('about_license')}}</a>.
      </p>

      <h3 style=padding-left:0>Special acknowledgements</h3>

      <p>
        ECAM tool is the result of a collaborative effort. WaCCliM project team thanks:
        <ul>
          <li>Members of the WaCCliM Taskforce and WaCCliM Expert pool for their voluntary
          contribution, providing scientific input and peer-review of ECAM.</li>
          <li>REaCH project (CTM2015-66892-R (MINECO/FEDER, UE), funded by the Spanish
          Ministry of Economy and Competitiveness and FEDER, for their support to ICRA.</li>
          <li>Technical support by Komptenzzentrum Wasser Berlin gGmbH.
        </ul>
      </p>

      <p>
        Chart library: <a target=_blank href="https://google-developers.appspot.com/chart/">Google Charts</a>
      </p>

      <img class="license_img license_img-big" src="frontend/img/CC_license_big.png" alt="">
      <br><br>
      ECAM by IWA and GIZ, implemented by ICRA for WaCCliM Project* is licensed under
      a <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. Based on a work
      at <a target="_blank" href="https://creativecommons.org/choose/www.wacclim.org">www.wacclim.org</a>. Permissions beyond the scope of this license may be available
      at <a target="_blank" href="https://creativecommons.org/choose/wacclim@giz.de">wacclim@giz.de</a>.
    </div>

    <!--logo wacclim-->
    <div>
      <img
        id=logo-wacclim
        src="frontend/img/logo-wacclim_big.png"
        style="height:120px;margin:1em auto;display:block"
      >
    </div>

    <!--logos iwa-->
    <div style=background:white;text-align:center;margin-top:50px;>
      <img src=frontend/img/logos.png>
    </div>
  </div>

  <!--help VIEW-->
  <div id=help v-if="visible">
    <h1 style=text-align:center>
      <span onclick="ecam.show('index')">{{translate('start')}}</span>
      &rsaquo;
      <span style=color:black>{{translate('help')}}</span>
    </h1>

    <h4><b>ECAM v2</b></h4>
    <table style=margin:auto>
      <tr><td><a target=_blank href="help_pdf/ECAM V2 FAQ_Aug2017.pdf">Frequently Asked Questions (pdf)</a></h4>
      <tr><td><a target=_blank href="help_pdf/ECAM-Methodology-Guide-Jan-2019.pdf">Methodology (pdf)</a></h4>
      <tr><td><a target=_blank href="help_pdf/ECAM_2.0_Manual_170822.pdf">Manual (pdf)</a></h4>
      <tr><td><a target=_blank href="help_pdf/ECAMV2 Example.json" download>Example json file (json)</a></h4>
    </table>

    <h4><b>Screencasts</b></h4>
    <a href="https://vimeopro.com/iwahq/tutorials-ecam-tool" target=_blank>https://vimeopro.com/iwahq/tutorials-ecam-tool</a>

    <img
      id=logo-wacclim
      src="frontend/img/logo-wacclim_big.png"
      style="display:block;height:120px;margin:1em auto"
    >
  </div>

  <!--get started VIEW-->
  <div id=get_started v-if="visible">
    <h1 style=text-align:center>{{translate('getStarted_subtitle')}}</h1>
    <table style=margin:auto>
      <tr>
        <th>{{translate('getStarted_table_name')}}
        <td><input
          id=Name
          v-model="Global.General.Name"
        >
      </tr>
      <tr>
        <th>{{translate('getStarted_table_start')}}
        <td><input type=date
          v-model="Global.General.AssessmentPeriodStart"
        >
      </tr>
      <tr>
        <th>{{translate('getStarted_table_end')}}
        <td><input type=date
          v-model="Global.General.AssessmentPeriodEnd"
        >
      </tr>
      <tr>
        <th>{{translate('getStarted_table_period')}}
        <td>{{Global.General.Days()}} {{translate('days')}}
      </tr>
      <tr>
        <th>{{translate('currency')}}
        <td>
          <div style="color:black;font-weight:bold">
            {{Global.General.Currency}}
          </div>
          {{translate('configuration_new_currency')}}:
          <input
            v-model="Global.General.Currency"
            size=3 maxlength=3 placeholder="ccc"
          >
        </td>
      </tr>
      <tr>
        <th>{{translate('getStarted_table_comments')}}
        <td>
          <textarea
            v-model="Global.General.Comments"
            :placeholder="translate('getStarted_max_200')"
            rows=5 cols=50 maxlength=200
          ></textarea>
      </tr>
    </table>

    <!--PREV&NEXT-->
    <div class=flex style="justify-content:center;margin-top:1em">
      <button class="button prev"
        onclick="event.stopPropagation();ecam.show('index')">
        {{translate('previous')}}
      </button>
      <button class="button next"
        onclick="event.stopPropagation();ecam.show('configuration')">
        {{translate('next')}}
      </button>
    </div>
  </div>

  <!--configuration VIEW-->
  <div id=configuration v-if="visible">
    <h1 style=text-align:center>
      {{translate('configuration')}}
    </h1>
    <div class=flex style=justify-content:center>
      <!--configuration left-->
      <div style="max-width:50%">
        <h4 style="margin:0;margin-bottom:1em;text-align:center">
          {{translate('configuration_subtitle')}}
        </h4>
        <table id=select_stages>
          <tr>
            <th>{{translate('quick_assessment')}}
            <th>{{translate('energy_performance')}}
          </tr>
          <tbody v-for="l1 in Structure.filter(l=>l.sublevel==false)">
            <tr>
              <td
                rowspan=4
                :style="Global.Configuration.ActiveStages[l1.alias]?'background:lightgreen':''"
              >
                <label>
                  <input type=checkbox
                    v-model="Global.Configuration.ActiveStages[l1.alias]"
                    @change="check_l2_from_l1()"
                  >
                  <img :src="`frontend/img/${l1.alias}.png`">
                  {{translate(l1.level)}}<br>
                </label>
              </td>
            </tr>
            <tr v-for="l2 in Structure.filter(l=>(l.sublevel && l.level==l1.level))">
              <td
                :style="Global.Configuration.ActiveStages[l2.alias]?'background:lightgreen':''"
              >
                <label>
                  <input type=checkbox
                    v-model="Global.Configuration.ActiveStages[l2.alias]"
                    @change="check_l1_from_l2()"
                  >
                  <img :src="`frontend/img/${l2.alias}.png`">
                  {{translate(l2.sublevel)}}<br>
                </label>
              </td>
            </tr>
          </tbody>
        </table>
        <div style=text-align:center>
          <button
            class=button
            @click="activate_all_stages()"
          >{{translate('configuration_activate_all')}}
          </button>
        </div>
      </div>

      <!--configuration right-->
      <div style="max-width:45%;padding:0em 1em 1em 1em">
        <!--select country-->
        <fieldset>
          <legend>{{translate('select_country')}}
            <select
              v-model="Global.General.Country"
              @change="set_variables_from_selected_country()"
            >
              <option value="false">--select--</option>
              <option v-for="country in Object.keys(Countries)">
                {{country}}
              </option>
            </select>
            <a onclick="ecam.show('countries')">Info</a>
          </legend>

          <table>
            <tr>
              <td v-html="translate('conv_kwh_co2_descr')">
              <td>
                <input v-model.number="Global.General.conv_kwh_co2">
              <td>kg<sub>CO<sub>2</sub></sub>/kWh
            <tr>
              <td v-html="translate('prot_con_descr')">
              <td>
                <input v-model.number="Global.General.prot_con">
              <td>kg/{{translate('person')}}/{{translate('year')}}
            <tr>
              <td v-html="translate('bod_pday_descr')">
              <td>
                <input v-model.number="Global.General.bod_pday">
              <td>g/{{translate('person')}}/{{translate('day')}}
            <tr>
              <td v-html="translate('bod_pday_fs_descr')">
              <td>
                <input v-model.number="Global.General.bod_pday_fs">
              <td>g/{{translate('person')}}/{{translate('day')}}
            </tr>
          </table>
        </fieldset>

        <!--fuel engines in any stage-->
        <fieldset>
          <legend>{{translate('do_you_have_engines')}}
          </legend>
          <label>
            {{translate('no')}}
            <input type=radio
              name=anyFuelEngines
              v-model.number="Global.General.anyFuelEngines"
              value=0
              @change=answerAnyFuelEngines()
            >
          </label> &emsp;
          <label>
            {{translate('yes')}}
            <input type=radio
              name=anyFuelEngines
              v-model.number="Global.General.anyFuelEngines"
              value=1
              @change=answerAnyFuelEngines()
            >
          </label>
        </fieldset>

        <div>
          <!--select assessment report-->
          <fieldset>
            <legend>
              {{translate('select_gwp_source')}}
              <!--select gwp report which defines gwp values-->
              <select
                v-model="Global.Configuration.Selected.gwp_reports_index"
                @change="set_constants_from_gwp_report()"
              >
                <option v-for="report,i in GWP_reports" :value="i">
                  {{report.report}}
                </option>
              </select>
              <a onclick="ecam.show('gwp_table')">Info</a>
            </legend>

            <!--description of gwp values-->
            <div style="padding:0.5em 0"
              v-html="translate('gwp_values_relative_to')"
            ></div>

            <!--actual gwp values-->
            <table>
              <tr>
                <td>{{translate('carbon_dioxide')}} (CO<sub>2</sub>)
                <td align=right>1
                <td>CO<sub>2</sub> {{translate('equivalents')}}
              <tr>
                <td>{{translate('methane')}} (CH<sub>4</sub>)
                <td align=right>{{Cts.ct_ch4_eq.value}}
                <td>CO<sub>2</sub> {{translate('equivalents')}}
              <tr>
                <td>{{translate('nitrouns_oxide')}} (N<sub>2</sub>O)
                <td align=right>{{Cts.ct_n2o_eq.value}}
                <td>CO<sub>2</sub> {{translate('equivalents')}}
              </tr>
            </table>
          </fieldset>
        </div>
      </div>
    </div>

    <!--prev & next buttons-->
    <div class=flex style="margin:1em;justify-content:center">
      <button class="button prev"
        onclick="event.stopPropagation();ecam.show('get_started')">
        {{translate('previous')}}
      </button>
      <button class="button next"
        onclick="event.stopPropagation();ecam.show('population')">
        {{translate('next')}}
      </button>
    </div>
  </div>

  <!--countries VIEW-->
  <div id=countries v-if="visible">
    <h1 style="text-align:center">
      <span onclick="ecam.show('configuration')">{{translate('configuration')}}</span>
      &rsaquo;
      <span style=color:black>{{translate('Countries')}}</span>
    </h1>
    <table style="margin:auto">
      <tr>
        <th rowspan=2>{{translate('Country')}}
        <th>
          {{translate('Emission_factor')}}<sup>1</sup>
          <br><a href=variable.php?id=conv_kwh_co2>(conv_kwh_co2)</a>
        </th>
        <th>
          {{translate('Annual_protein_consumption')}}<sup>2</sup>
          <br><a href=variable.php?id=prot_con>(prot_con)</a>
        </th>
        <th>
          BOD<sub>5</sub><sup>3</sup>
          <br><a href=variable.php?id=bod_pday>(bod_pday)</a>
        </th>
      </tr>
      <tr>
        <th>kgCO<sub>2</sub>/kWh
        <th>kg/{{translate('person')}}/{{translate('year')}}
        <th>g/{{translate('person')}}/{{translate('day')}}
      </tr>
      <tr v-for="country,name in Countries"
        :class="Global.General.Country==name?'selected':''"
      >
        <td><b>{{name}}</b>
        <td class=number>{{country.conv_kwh_co2}}
        <td class=number>{{country.prot_con}}
        <td class=number>{{country.bod_pday}}
      </tr>
    </table>

    <table id=references style="margin:auto">
      <tr><td colspan=2>{{translate('References')}}
      <tr><td>1<td>BRANDER, M. SOOD A. WYLIE, C. HAUGHTON, A. LOVELL, J., 2011,Technical Paper Electricity-specific emission factors for grid electricity, Ecometrica,
      <tr><td>2<td>
        <a href="docs/FAO.xls" target=_blank>
          FAO Statistics Division, 2010, Food Balance Sheets
        </a>
      <tr>
      <tr><td>3<td>
        <a href="docs/IPCC_V5_6_Ch6_Wastewater.pdf" target=_blank>
          IPCC, 2006, Guidelines for National Greenhouse Gas Inventories
          Volume 5 Waste, Chapter 6
        </a>
      </tr>
    </table>
  </div>

  <!--gwp table VIEW-->
  <div id=gwp_table v-if="visible">
    <h1 style="text-align:center">
      <a onclick="ecam.show('configuration')">{{translate('configuration')}}</a>
      &rsaquo;
      <span style=color:black>{{translate('gwp_title')}}</span>
    </h1>

    <table style="margin:auto">
      <tr>
        <th colspan=5>{{translate('gwp_title_table')}}
      </tr>
      <tr>
        <th>{{translate('Report')}}
        <th>CO<sub>2</sub> (CO<sub>2</sub> {{translate('equivalents')}})
        <th>CH<sub>4</sub> (CO<sub>2</sub> {{translate('equivalents')}})
        <th>N<sub>2</sub>O (CO<sub>2</sub> {{translate('equivalents')}})
        <th>{{translate('Comments')}}
      </tr>
      <tr v-for="rep,i in GWP_reports" :class="Global.Configuration.Selected.gwp_reports_index==i ? 'selected':''">
        <td><b>{{rep.report}}</b>
        <td class=number>1
        <td class=number>{{rep.ct_ch4_eq}}
        <td class=number>{{rep.ct_n2o_eq}}
        <td><small>{{rep.comment}}</small>
      </tr>
    </table>
  </div>

  <!--population VIEW-->
  <div id=population v-if="visible">
    <h1 style="text-align:center">{{translate('population')}}</h1>

    <h4 style="text-align:center;margin:0;margin-bottom:1em">
      {{translate("Enter the population living at each level of your system")}}
    </h4>

    <table style="font-size:16px;margin:auto;width:50%">
      <tbody v-for="l1 in Structure.filter(s=>s.sublevel==false)">
        <tr>
          <th colspan=3 :style=`background:${l1.color};text-align:left`>
          <img :src="`frontend/img/${l1.alias}.png`" width=25 style="line-height:4em;vertical-align:middle">
          {{translate(l1.level)}}
        </tr>
        <tr v-if="!Global.Configuration.ActiveStages[l1.alias]">
          <td colspan=3 inactive>{{translate('birds_stage_not_active')}}
        </tr>
        <tr v-else v-for="pop in Population.filter(p=>p.level==l1.level)">
          <td
            @mousemove="caption.show($event, translate(pop.code+'_expla'))"
            @mouseout="caption.hide()"
          >
            {{translate(pop.code+'_descr')}}
          </td>
          <td class=input_container>
            <input
              :value="format(pop.stage[pop.code])"
              @focus="focus_input(pop, $event)"
              @blur="blur_input(pop, $event)"
              :tabindex="Population.indexOf(pop)+1"
              style="text-align:right"
            >
          </td>
          <td><small>{{translate('people')}}</small></td>
        </tr>
      </tbody>
    </table>

    <!--prev next buttons-->
    <div class=flex style="justify-content:center;margin-top:1em">
      <button class="button prev"
        onclick="event.stopPropagation();ecam.show('configuration')">
        {{translate('previous')}}
      </button>
      <button class="button next"
        onclick="event.stopPropagation();ecam.show('tier_a')">
        {{translate('next')}}
      </button>
    </div>
  </div>

  <!--tier a VIEW-->
  <div id=tier_a v-if="visible">
    <h1>
      {{translate('quick_assessment')}} &mdash;
      {{translate('initial_estimation_description')}}
    </h1>

    <!--context info below tier A title-->
    <div class=flex
      style="
        background:#fafafa;
        box-shadow: 0 1px 2px rgba(0,0,0,.5);
        color:#666;
        font-size:smaller;
        justify-content:space-between;
        padding:0.5em 2em;
      ">
      <!--assessment period-->
      <div>
        <a onclick="ecam.show('get_started')">
          {{translate('assessment_period')}}
        </a>:
        <span>
          {{ format(Global.General.Days()) }}
        </span>
        <span>
          {{ translate('days') }}
        </span>
      </div>

      <!--conv_co2_kwh-->
      <div>
        <a onclick="ecam.show('configuration')">
          {{translate('conversion_factor')}}
        </a>:
        <span>
          {{format(Global.General.conv_kwh_co2)}}
        </span>
        <span>
          kg CO<sub>2</sub>eq/kWh
        </span>
      </div>

      <!--prot_cont-->
      <div>
        <a onclick="ecam.show('configuration')">
          {{translate('Annual_protein_consumption')}}
        </a>:
        <span>
          {{format(Global.General.prot_con)}}
        </span>
        <span>
          kg/{{ translate('person') }}/{{ translate('year') }}
        </span>
      </div>

      <!--bod_pday-->
      <div>
        <a onclick="ecam.show('configuration')">
          {{translate('bod_pday_descr')}}
        </a>:
        <span>
          {{format(Global.General.bod_pday)}}
        </span>
        <span>
          kg/{{ translate('person') }}/{{ translate('day') }}
        </span>
      </div>
    </div>

    <!--tier a main container-->
    <div class=flex style="padding:10px 2px">
      <!--tier a inputs container-->
      <div>
        <table>
          <tbody v-for="level,key in Global.Tier_A">
            <tr :style="`color:white;background:${Structure.find(s=>s.level==key).color}`">
              <td colspan=3>
                <img :src="`frontend/img/${Structure.find(s=>s.level==key).alias}.png`"
                  style="width:25px;line-height:4em;vertical-align:middle"
                >
                {{translate(key)}}
              </td>
            </tr>
            <!--stage not active indicator-->
            <tr v-if="!Global.Configuration.ActiveStages[Structure.find(s=>s.level==key).alias]">
              <td colspan=3 style="color:#999;background:#eee;font-size:smaller">
                {{translate('birds_stage_not_active')}}
              </td>
            </tr>
            <!--tier a inputs-->
            <tr
              v-if="Global.Configuration.ActiveStages[Structure.find(s=>s.level==key).alias]"
              v-for="val,code in level"
            >
              <!--tier a input description-->
              <td :colspan="(Info[code] && Info[code].magnitude=='Option') ? 3 : 1">
                <div>
                  <!--tier a input description-->
                  <div>
                    <div v-if="Questions[code]">
                      {{ translate(code) }}?
                    </div>
                    <div v-else>
                      {{ translate(code+'_descr') }}
                    </div>
                  </div>
                  <!--options select element-->
                  <div v-if="Info[code] && Info[code].magnitude=='Option'">
                    <select v-model="level[code]">
                      <option v-for="obj,key in Tables[code]" :value="obj.value">
                        {{translate(key)}}
                      </option>
                    </select>
                  </div>
                </div>
              </td>

              <!--tier a input value: only questions and non-options-->
              <td
                v-if="Questions[code] || (Info[code] && Info[code].magnitude!='Option')"
                :colspan="Questions[code] ? 2 :1"
                style="padding:0"
              >
                <div v-if="Questions[code]">
                  <label>
                    <input type=checkbox v-model="level[code]">
                    {{translate('yes')}}
                  </label>
                </div>
                <div v-else>
                  <input type=number v-model.number="level[code]">
                </div>
              </td>

              <!--tier a input unit-->
              <td v-if="!Questions[code] && !(Info[code] && Info[code].magnitude=='Option')">
                <span v-html="get_current_unit(code).prettify()"></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!--tier a figures charts graphs-->
      <div style="margin-left:2px">
        figures here TODO
        <ul>
          <li>ghg emissions by source
          <li>energy consumption
          <li>water supply total running costs
          <li>wastewater total running costs
          <li>serviced population in water supply
          <li>total ghg water supply
          <li>serviced population in wastewater
          <li>total ghg wastewater
          <li>serviced population in fsm
          <li>total ghg fsm
        </ul>
      </div>
    </div>

    <!--tier a prev next buttons-->
    <div>
      <button class="button prev"
        onclick="event.stopPropagation();ecam.show('population')">
        {{translate('previous')}}
      </button>
      <button class="button next"
        onclick="event.stopPropagation();ecam.show('tier_b')">
        {{translate('next')}}
      </button>
    </div>
  </div>

  <!--tier b VIEW-->
  <div id=tier_b v-if="visible">
    <!--tier b title + tips-->
    <div class=flex
      style="
        justify-content:space-between;
      "
    >
      <h1>
        <a onclick="ecam.show('get_started')">{{Global.General.Name}}</a>
        <span style="color:black">&rsaquo;</span>
        <a onclick="linear_menu.go_to(tier_b.level)"
          :style="`cursor:pointer;color:${Structure.find(s=>s.level==level).color}`"
        >
          {{translate(level)}}
        </a>
        <span v-if="sublevel">
          <span style="color:black">&rsaquo;</span>
          <span style="font-size:larger;color:black">
            {{translate(sublevel)}}</span>
        </span>
      </h1>

      <!--Tips-->
      <div @click="Tips.random()"
        style="
          font-size:12px;
          color:#666;
          cursor:pointer;
          padding:0.5em;
          line-height:3em;
        "
      >
        <svg style="vertical-align:text-bottom" viewBox="0 0 12 16" width="12" height="16" aria-hidden="true">
          <path fill-rule="evenodd"
            d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"
          ></path>
        </svg>
        <strong>{{translate('Tip')}}!</strong>
        <span v-html="translate(Tips.current)"></span>
        &emsp; &#9654;
      </div>
    </div>

    <!--tier b context info-->
    <div class=flex style="justify-content:space-between;background:#fafafa;font-family:monospace;padding:0.2em 2em;font-size:smaller">
      <!--assessment period-->
      <div>
        <a onclick="ecam.show('get_started')">
          {{translate('assessment_period')}}:
          <b style=color:black>
            <span :class="Global.General.Days()==0 ? 'warning' : ''">
              {{format(Global.General.Days())}}
            </span>
          </b>
          &emsp;
          <span>
            {{translate('days')}}
          </span>
        </a>
      </div>

      <!--resident population-->
      <div>
        <a onclick="ecam.show('population')">
          {{translate('ws_resi_pop_descr')}}:
          <b v-if="level=='Water'" style=color:black>
            <span :class="Global.Water.ws_resi_pop==0 ? 'warning' : ''">
              {{format(Global.Water.ws_resi_pop)}}
            </span>
          </b>
          <b v-if="level=='Waste'" style=color:black>
            <span :class="Global.Waste.ww_resi_pop==0 ? 'warning' : ''">
              {{format(Global.Waste.ww_resi_pop)}}
            </span>
          </b>
          <b v-if="level=='Faecl'" style=color:black>
            <span :class="Global.Faecl.fs_resi_pop==0 ? 'warning' : ''">
              {{format(Global.Faecl.fs_resi_pop)}}
            </span>
          </b>
        </a>
      </div>

      <!--connected population only ww-->
      <div v-if="level=='Waste'">
        <a onclick="ecam.show('population')">
          {{translate('ww_conn_pop_descr')}}:
          <b style=color:black>
            <span :class="Global.Waste.ww_conn_pop()==0 ? 'warning' : ''">
              {{format(Global.Waste.ww_conn_pop())}}
            </span>
          </b>
        </a>
      </div>

      <!--serviced population-->
      <div>
        <div v-if="level=='Water'">
          <a onclick="ecam.show('population')">
            {{translate('ws_serv_pop_descr')}}:
            <b style=color:black>
              <span :class="Global.Water.ws_serv_pop==0 ? 'warning' : ''">
                {{format(Global.Water.ws_serv_pop)}}
              </span>
            </b>
          </a>
        </div>

        <div v-if="level=='Waste'">
          <a onclick="ecam.show('population')">
            {{translate('ww_serv_pop_descr')}}:
            <b style=color:black>
              <span :class="Global.Waste.ww_serv_pop()==0 ? 'warning' : ''">
                {{format(Global.Waste.ww_serv_pop())}}
              </span>
            </b>
          </a>
        </div>

        <div v-if="level=='Faecl'">
          <a onclick="ecam.show('population')">
            {{translate('fs_onsi_pop_descr')}}:
            <b style=color:black>
              <span :class="Global[level].fs_onsi_pop==0 ? 'warning' : ''">
                {{format(Global[level].fs_onsi_pop)}}
              </span>
            </b>
          </a>
        </div>
      </div>

      <!--kwh to co2 conversion-->
      <div>
        <a onclick="ecam.show('configuration')">
          {{translate('conv_kwh_co2_descr')}}:
          <b style=color:black>
            <span :class="Global.General.conv_kwh_co2==0 ? 'warning' : ''">
              {{format(Global.General.conv_kwh_co2)}}
            </span>
          </b>
          <span class=number v-html="Info.conv_kwh_co2.unit"></span>
        </a>
      </div>
    </div>

    <!--tier b inputs and outputs-->
    <div style="display:grid;grid-template-columns:62% 38%;padding-right:3px">
      <!--tier b inputs-->
      <div style="padding:0 3px">
        <div class="table-title">
          {{translate('INPUTS') }} &mdash;
          {{translate('Enter values for') }}
          {{sublevel ? translate(sublevel) : translate(level) }}
          {{translate('stages') }}
        </div>

        <!--tier b input table-->
        <table style="width:100%">
          <!--tier b inputs header-->
          <thead>
            <tr :style="`background:${Structure.find(s=>s.level==level).color}`">
              <td>
                <div style="display:grid;grid-template-columns:60% 30% 10%">
                  <div style="background:inherit;color:white;text-align:center">{{translate('Description')   }}</div>
                  <div style="background:inherit;color:white;text-align:center">{{translate('Current value') }}</div>
                  <div style="background:inherit;color:white;text-align:center">{{translate('edit_unit')     }}</div>
                </div>
              </td>
            </tr>
          </thead>

          <!--tier b inputs-->
          <tbody>
            <tr
              v-for="key in Object.keys(current_stage).filter(key=>{return Questions.is_inside(key)==false})"
              v-if="typeof(current_stage[key])=='number'"
            ><td>
              <input_ecam
                :code="key"
                :current_stage="current_stage"
              ></input_ecam>
            </tr>
          </tbody>

          <!--tier b questions-->
          <tbody v-for="question in Questions.get_questions(current_stage)">
            <tr
              :style="`background:${Global.Configuration.Questions[question]?'lightgreen':'#eee'}`"
            ><td
              :class="Questions.is_question_hidden(question) ? 'disabled_question' : ''"
            >
              <div style="display:grid;grid-template-columns:50% 50%">
                <!--question text-->
                <div
                  @click="Questions[question].folded^= Global.Configuration.Questions[question]"
                  class="question_container flex"
                  :style="(Global.Configuration.Questions[question]?'cursor:pointer':'')"
                >
                  <div
                    v-if="Global.Configuration.Questions[question]"
                  >
                    <!--question folded marker-->
                    <div :class="`question_fold_marker ${Questions[question].folded?'folded':''}`">
                      ▼
                    </div>
                  </div>
                  <div v-html="translate(question)+'?'"
                    :class="Global.Configuration.Questions[question] ? 'question_text':''"
                    style="margin-left:5px"
                  ></div>
                </div>

                <!--question set value button-->
                <div :title="question">
                  <label>
                    <input type=checkbox
                      :disabled="Questions.is_question_hidden(question)"
                      @change="set_question(question, $event.target.checked)"
                      :checked="Global.Configuration.Questions[question]"
                    >
                    <span v-html="translate('yes')"></span>
                  </label>
                </div>
              </div>
            </td></tr>
            <tr
              v-for="key in Questions[question].variables"
              v-if="
                Global.Configuration.Questions[question]
                &&
                typeof(current_stage[key])=='number'
                &&
                (!Questions[question].folded)
              "
            ><td>
              <input_ecam
                :code="key"
                :question="question"
                :current_stage="current_stage"
              ></input_ecam>
            </tr>
          </tbody>

          <!--decoration bottom table-->
          <tfoot>
            <tr :style="`background:${Structure.find(s=>s.level==level).color}`">
              <th style="background:inherit;border-bottom:none" colspan=4>
            </tr>
          </tfoot>
        </table>
      </div>

      <!--tier b outputs-->
      <div>
        <!--level2 outputs: GHG header-->
        <div class="table-title">
          {{translate('OUTPUTS') }} &mdash;
          {{translate('GHG emissions') }}
        </div>

        <!--level2 outputs: GHG content-->
        <table style=width:100%>
          <thead>
            <tr>
              <th>{{translate('Origin')}}
              <th>kg CO<sub>2</sub>eq<br>{{translate('assessment period')}}
              <th v-if="Normalization[level] && Normalization[level].serv_pop">
                kg CO<sub>2</sub>eq<br>per {{translate('year')}} <br>per {{translate('serv.pop.')}}
              </th>
              <th v-if="Normalization[level] && Normalization[level].volume">
                kg CO<sub>2</sub>eq<br>per m<sup>3</sup>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              v-for="key in Object.keys(current_stage)"
              v-if="
                typeof(current_stage[key])=='function'
                && (1+key.search('_KPI_GHG'))
                && Questions.is_hidden(key)==false
              "
            >
              <td
                @mousemove="caption.show($event, translate(key+'_expla'))"
                @mouseout="caption.hide()"
              >
                <div v-html="translate(key+'_descr').prettify()"></div>
                (<a @click="variable.view(key)">{{key}}</a>)
              </td>

              <!--output value-->
              <td
                v-html="format(current_stage[key]())"
                @mousemove="caption.show($event, Formulas.prettify(current_stage[key]))"
                @mouseout="caption.hide()"
                style="text-align:right"
              ></td>

              <!--emission per year and serviced population-->
              <td
                v-if="Normalization[level] && Normalization[level].serv_pop"
                v-html="format( Normalization[level].serv_pop(current_stage[key]()))"
                style="text-align:right"
              ></td>

              <!--emission per m3 of water treated-->
              <td
                v-if="Normalization[level] && Normalization[level].volume && sublevel"
                v-html="format( Normalization[level][sublevel].volume(current_stage[key]()))"
                style="text-align:right"
              ></td>
              <td
                v-else-if="Normalization[level] && Normalization[level].volume && !sublevel"
                v-html="format( Normalization[level].volume(current_stage[key]()))"
                style="text-align:right"
              ></td>
            </tr>
          </tbody>
          <!--decoration bottom table-->
          <tfoot>
            <tr><th style="border-bottom:none" colspan=4></tr>
          </tfoot>
        </table>

        <!--level2 outputs: NRG and SL-->
        <div class="table-title">
          {{translate('OUTPUTS')}} &mdash;
          {{translate('Energy performance and Service Level indicators')}}
        </div>
        <table style=width:100%>
          <tr>
            <th>{{translate('edit_description')}}
            <th>{{translate('edit_current_value')}}
            <th>{{translate('edit_unit')}}
          </tr>
          <tbody>
            <tr
              v-for="key in Object.keys(current_stage)"
              v-if="
                typeof(current_stage[key])=='function' &&
                -1==key.search('_KPI_GHG') &&
                Questions.is_hidden(key)==false
              "
            >
              <td
                @mousemove="caption.show($event, translate(key+'_expla'))"
                @mouseout="caption.hide()"
              >
                <div v-html="translate(key+'_descr').prettify()"></div>
                (<a @click="variable.view(key)">{{key}}</a>)
              </td>

              <!--output value-->
              <td
                v-html="format(current_stage[key]())"
                @mousemove="caption.show($event, Formulas.prettify(current_stage[key]))"
                @mouseout="caption.hide()"
                style="text-align:right"
              ></td>
              <td v-html="Info[key].unit.prettify()"></td>
            </tr>
          </tbody>
          <!--decoration bottom table-->
          <tfoot>
            <tr><th style="border-bottom:none" colspan=4></tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!--summary ghg VIEW-->
  <div id=summary_ghg v-if="visible">
    <!--summary ghg title-->
    <h1 style="text-align:center">
      <div>
        <span>{{ Global.General.Name }}</span> &mdash;
        <span>{{ translate("GHG Emissions Summary (Overview)") }}</span> &mdash;
        <span>{{ translate("assessment_period") }}:</span>
        <span>
           <span>{{format(Global.General.Days( )) }}</span> {{ translate("days")  }}
          (<span>{{format(Global.General.Years()) }}</span> {{ translate("years") }})
        </span>
      </div>
    </h1>

    <!--summary ghg table-->
    <div style="padding:0 2px">
      <table border=1 style="margin:auto">
        <!--total ghg-->
        <tr>
          <td colspan=3 style="text-align:center">
            {{ translate("TOTAL GHG")            }}:
            {{ format(Global.General.TotalGHG()) }}
            <span class=unit>
              kgCO<sub>2</sub>eq
            </span>
          </td>
        </tr>
        <tr>
          <td v-for="stage in Structure.filter(s=>s.sublevel==false)" style="padding:5px;vertical-align:top">
            <!--level1 ghg-->
            <div class=flex style="align-items:center">
              <div>
                <img :src="`frontend/img/${stage.alias}.png`" style="width:25px">
              </div>
              <div style="margin-left:5px">
                <a @click="go_to(stage.level)" style="cursor:pointer">
                  {{translate(stage.level)}}
                </a>:
                {{format(Global[stage.level][`${stage.prefix}_KPI_GHG`]())}}
                <span class=unit>
                  kgCO<sub>2</sub>eq
                </span>
              </div>
            </div>

            <!--level2 ghg-->
            <table border=1 style="margin:5px">
              <tr v-for="stage2 in Structure.filter(s=>(s.sublevel && s.level==stage.level))">
                <td>
                  <div class=flex style="align-items:center">
                    <div>
                      <img :src="`frontend/img/${stage2.alias}.png`" style="width:20px">
                    </div>
                    <div style="margin-left:5px">
                      <a @click="go_to(stage2.level, stage2.sublevel)" style="cursor:pointer">
                        {{translate(stage2.sublevel)}}
                      </a>
                    </div>
                  </div>
                </td>
                <td>
                  {{ format(Global[stage2.level][stage2.sublevel][`${stage2.prefix}_KPI_GHG`]()) }}
                </td>
                <td>
                  <span class=unit>
                    kgCO<sub>2</sub>eq
                  </span>
                </td>
              </tr>
              <tr v-if="stage.level=='Waste'">
                <td>
                  {{translate("ww_KPI_GHG_unt_descr")}}:
                </td>
                <td>
                  {{ format(Global.Waste.ww_KPI_GHG_unt()) }}
                </td>
                <td>
                  <span class=unit>kgCO<sub>2</sub>eq</span>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>

      <!--emissions outside boundaries-->
      <div style="margin:10px 0">
        <table border=1 style="margin:auto">
          <tr>
            <th style=background:purple>
              {{translate("GHG emissions")}}
              <br>
              {{translate("outside utility boundaries")}}
              <br>
              (kg CO<sub>2</sub> eq)
            </th>
            <td>
              <a @click="variable.view('ww_SL_ghg_unc')" title="ww_SL_ghg_unc">
                {{translate("ww_SL_ghg_unc_descr")}}
              </a>
            </td>
            <td>
              {{format(Global.Waste.ww_SL_ghg_unc())}}
            </td>
            <td>
              <span class=unit>kgCO<sub>2</sub>eq</span>
            </td>
          </tr>
        </table>
        <div style="font-size:smaller;text-align:center">
          {{translate('Note: the emissions above have not been added in the totals presented in the GHG emissions summary')}}
        </div>
      </div>

      <!--emissions avoided-->
      <div style="margin:10px 0">
        <table border=1 style="margin:auto">
          <tr>
            <th style=background:#bbb :rowspan="ghg_avoided.length+1">
              <a @click="variable.view('ww_GHG_avoided')" style="color:white" title="ww_GHG_avoided">
                {{ translate("ww_GHG_avoided_descr") }}
              </a>
              <div>
                <span v-html="format( Global.Waste.ww_GHG_avoided() )">
                </span>
              </div>
              <small>
                kg CO<sub>2</sub> eq / {{translate("assessment period")}}
              </small>
            </th>
          </tr>
          <tr v-for="obj in ghg_avoided">
            <td>
              <a @click="variable.view(obj.code)" :title="obj.code">
                {{ translate(obj.code+'_descr') }}
                <span v-if="obj.code.search('fs')==0">
                  (FSM)
                </span>
              </a>
            </td>
            <td>
              <span v-html="format( Global[obj.level][obj.sublevel][obj.code]() )">
              </span>
            </td>
          </tr>
        </table>
        <div style="font-size:smaller;text-align:center">
          {{ translate('Note: the emissions above have not been subtracted in the totals presented in the GHG emissions summary')}}
        </div>
      </div>
    </div>
  </div>

  <!--summary nrg VIEW TODO-->
  <div id=summary_nrg v-if="visible">
    <!--summary nrg title-->
    <h1 style="text-align:center">
      <div>
        <span>{{ Global.General.Name }}                               </span> &mdash;
        <span>{{ translate("Energy consumption Summary (Overview)") }}</span> &mdash;
        <span>{{ translate("assessment_period") }}:                   </span>
        <span>
           <span>{{format(Global.General.Days( )) }}</span> {{ translate("days")  }}
          (<span>{{format(Global.General.Years()) }}</span> {{ translate("years") }})
        </span>
      </div>
    </h1>

    <!--summary nrg table-->
    <div style="padding:0 2px">
      <table border=1 style="margin:auto">
        <!--total nrg-->
        <tr>
          <td colspan=3 style=text-align:center>
            {{ translate("TOTAL ENERGY CONSUMED") }}:
            {{ format(Global.General.TotalNRG()) }}
            <span class=unit>kWh</span>
          </td>
        </tr>

        <!--nrg level1 and level2-->
        <tr>
          <td v-for="stage in Structure.filter(s=>s.sublevel==false)" style="padding:5px;vertical-align:top">
            <!--level 1 nrg-->
            <div class=flex style="align-items:center">
              <div>
                <img :src="`frontend/img/${stage.alias}.png`" style="width:25px">
              </div>
              <div style="margin-left:5px">
                <a @click="go_to(stage.level)" style="cursor:pointer">
                  {{translate(stage.level)}}
                </a>:
                {{ format(Global[stage.level][`${stage.prefix}_nrg_cons`]()) }}
                <span class=unit>kWh</span>
              </div>
            </div>

            <!--level2 nrg-->
            <table border=1 style="margin:5px;">
              <tr v-for="stage2 in Structure.filter(s=>(s.sublevel && s.level==stage.level))">
                <td>
                  <div class=flex style="align-items:center">
                    <div>
                      <img :src="`frontend/img/${stage2.alias}.png`" style="width:20px">
                    </div>
                    <div style="margin-left:5px">
                      <a @click="go_to(stage2.level, stage2.sublevel)" style="cursor:pointer">
                        {{translate(stage2.sublevel)}}:
                      </a>
                    </div>
                  </div>
                </td>
                <td>
                  {{ format(Global[stage2.level][stage2.sublevel][`${stage2.prefix}_nrg_cons`]) }}
                </td>
                <td>
                  <span class=unit>kWh</span>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <!--opportunities VIEW TODO-->
  <div id=opportunities v-if="visible">opportunities TODO</div>

  <!--variable VIEW TODO-->
  <div id=variable v-if="visible">
    <!--variable title-->
    <h1>
      <span style=color:#999>
        {{ translate('variable_detailed_info') }}
        &rarr;
      </span>
      <code>{{id}}</code>
      <p v-if="Info[id]" style="margin-bottom:0">
        <code>{{ translate(id+'_descr') }}</code>
      </p>
      <div v-else class=error>
        ERROR: Variable {{id}} not defined in backend/info.js
      </div>
    </h1>

    <!--variable table-->
    <table v-if="Info[id]"
      :style="
        'text-align:left;width:70%;margin:auto;'+
        `background:${get_level_color()}`
      "
    >
      <!--variable stage-->
      <tr>
        <th>
          {{ translate('variable_stage') }}
        </th>
        <td>
          <div v-if="localization">
            &larr;

            <a v-if="localization.level=='General'" onclick="ecam.show('configuration')">
              {{translate('getStarted_general_info')}}
            </a>
            <span v-else>
              <a @click="go_to(localization.level)">
                {{ translate(localization.level) }}
              </a>
              <span v-if="localization.sublevel">
                /
                <a @click="go_to(localization.level, localization.sublevel)">
                  {{ translate(localization.sublevel) }}
                </a>
              </span>
            </span>
          </div>
        </td>
      </tr>

      <!--variable explanation-->
      <tr>
        <th>
          {{ translate('variable_explanation') }}
        </th>
        <td>
          <code>
            {{ translate(id+'_expla') }}
          </code>
        </td>
      </tr>

      <!--variable is inside a question?-->
      <tr v-if="question">
        <th>
          {{ translate("Filter that activates it") }}
        </th>
        <td>
          <div v-if="question">
            <span v-html="translate(question)+'?'"></span>
            [{{ translate( (Global.Configuration.Questions[question])?'yes':'no' )}}]
          </div>
        </td>
      </tr>

      <!--variable type-->
      <tr>
        <th>
          {{ translate('variable_type') }}
        </th>
        <td>
          <div>
            <div style="font-size:large">
              {{ get_variable_type().ucfirst() }}
            </div>

            <!--show formula-->
            <div v-if="get_variable_type()=='output'">
              <div style="border:1px solid #ccc;padding:1em">
                <div>
                  {{ translate('variable_formula') }}:
                </div>
                <div
                  v-html="Formulas.prettify(get_current_stage()[id].toString())"
                  style="font-family:monospace"
                ></div>
              </div>

              <!--show inputs involved-->
              <div style="margin-top:10px">
                <b>
                  {{ translate('variable_inputs_involved') }}
                </b>
              </div>

              <table>
                <tr v-for="match in Formulas.ids_per_formula(get_current_stage()[id].toString())">
                  <td>
                    <a @click="view(match)">
                      {{match}}
                    </a>
                  </td>
                  <td>
                    <div v-html="format(get_variable_value(match))">
                    </div>
                  </td>
                  <td>
                    <div class=unit v-html="Info[match].unit.prettify()">
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </td>
      </tr>

      <!--variable current value-->
      <tr>
        <th>
          {{ translate("Current value") }}
        </th>
        <td>
          <div v-if="get_variable_type()=='input'">
            <input type=number v-model.number="get_current_stage()[id]">
            <span class=unit v-html="Info[id].unit.prettify()"></span>
          </div>
          <div v-if="get_variable_type()=='output'">
            <span v-html="format( get_current_stage()[id]()/Units.multiplier(id) )">
            </span>
            <span class=unit>
              <span v-html="get_current_unit(id).prettify()"></span>
            </span>
          </div>
        </td>
      </tr>

      <!--variable magnitude-->
      <tr>
        <th>
          {{ translate('variable_magnitude') }}
        </th>
        <td>
          {{ Info[id].magnitude }}
        </td>
      </tr>

      <!--outputs that use this variable-->
      <tr>
        <th>
          {{ translate("Outputs that use this value") }}
        </th>
        <td>
          <table>
            <tr v-for="output in Formulas.outputs_per_input(id)">
              <td>
                <a @click="view(output)">
                  {{ output }}
                </a>
              </td>
              <td>
                <div v-html="format(get_variable_value(output))">
                </div>
              </td>
              <td>
                <span class=unit v-html="get_current_unit(output).prettify()">
                </span>
              </td>
            </tr>
            <tr v-if="Formulas.outputs_per_input(id).length==0">
              <td>
                <span style=color:#999>{{ translate('variable_nothing') }}</span>
              </td>
            </tr>
          </table>
        </td>
      </tr>

      <tr>
        <th>values in substages
        <td>values in substages TODO
      </tr>

      <tr>
        <th>It has recommendations?
        <td>it has recommendations? TODO
      </tr>

      <tr>
        <th>If input:is used in benchmarking?
        <td>if input:is used in benchmarking? TODO
      </tr>

      <tr>
        <th>Is "id" benchmarked?
        <td>is "id" benchmarked? TODO
      </tr>

    </table>
  </div>

  <!--pending-------------------------------------------------------------->
  <div style="border-top:1px solid;margin-top:10px">
    <h3>&emsp; v3 development tasks</h3>
    <ul>
      <li><b>DOING NOW</b>: tier A / refactoring backend and redoing user interface
        <ul>
          <li>outputs
          <li>find a better + offline + open source + memory efficient + fast chart library
        </ul>
      </li>
      <li><b>DOING NEXT</b>: summaries (ghg and energy)
      <li>"new", "open", and "save as" buttons
      <li>tier b substages (discussion with viti needed)
        <ul>
          <li>benchmarks
        </ul>
      </li>
      <li>reporting tool (new feature)
      <li>compabibility module ['Yes/No':'Questions']
      <li>
        Landing Page
        <ul>
          <li>Design should be improved
          <li>Links don’t look appealing
          <li>Should include information about income
          <li>“Help” button is not easy to find
          <li>Support docs are missing (esp. Spanish)
        </ul>
      </li>
      <li>
        General Info
        <ul>
          <li>It should be obvious which data is relevant and why (Colours, symbol etc)
        </ul>
      </li>
      <li>
        Population
        <ul>
          <li>Names of input fields could be clearer
          <li>It’s not clear that the definitions appear if you hover over the fields. A simple (?) could help
          <li>Definitions should be shorter and more concrete (see FSM, missing definitions)
        </ul>
      </li>
      <li>
        Configuration
        <ul>
          <li>Difference between Tier A and B is not clear
          <li>They are two different assessments, but it looks like you have to do both + the costs can only be inserted in Tier A. If in ECAM 3.0 both tiers are completely separated, costs should also be inserted in Tier B.
        </ul>
      </li>
      <li>
        Tier A:
        <ul>
          <li>There should be an explanatory sentence on what Tier A (and B), also highlighting the importance of data
          <li>Results of Tier A are confusing because there are shown as “Outputs” and not as assumed under “Summaries”.
          <li>Sankey Graphic is not easy to find, it should be under graphics /summary
        </ul>
      </li>
      <li>
        Tier B:
        <ul>
          <li>The tips in the top right corner get lost
          <li>Advance assessment is easily overseen (+)
          <li>Advance assessment is not clear. When should this be used and how? For example, it should be used if there are different treatment technologies
        </ul>
      </li>
      <li>
        Summaries page:
        <ul>
          <li>Difference between Tier A and B results should be clearer
          <li>Units of results could be more obvious
          <li>Results of sub-stages are only shown when the box is ticked. This is not clear
        </ul>
      </li>
      <li>
        Opportunities page:
        <ul>
          <li>It is not clear how to use it or how results are to be interpreted.
          <li>Spanish translations are needed
        </ul>
      </li>
    </ul>
  </div>
</div>

<!--load vue components-->
<script src="frontend/vue-components.js"></script>
<script src="frontend/input-ecam.js"></script>
<script src="frontend/defaults.js"></script>

<!--add sidebar onclick listeners to hide the sidebar-->
<script>
  //clicking anywhere hides sidebar
  document.documentElement.addEventListener('click',function(){
    sidebar.visible=false;
  });

  //ESC key hides the sidebar
  document.documentElement.addEventListener('keydown',function(ev){
    if(ev.which==27){ sidebar.visible=false; }
  });

  //afegir listener onclose per no perdre les dades TODO
</script>
