digraph MyGraph {
  rankdir=LR

  wsa [label="Abstraction"]
  wst [label="Treatment"]
  wsd [label="Distribution"]
  pop [label="Population"]
  ww  [label="Wastewater"]
  unc [label="Uncollected"]
  col [label="Collected"]
  unt [label="Untreated wastewater"]
  wwt [label="Wastewater treatment plant"]
  ons [label="Onsite sanitation"]

  dis [label="Discharge"]
  riv [label="Freshwater, estuarine,\nmarine environments, agricultural soils"]
  reu [label="Reuse/Nutrient recovery"]

  slu [label="Dry sludge"]
  inc [label="Incineration"]
  laf [label="Landfilling"]
  lap [label="Land application"]
  com [label="Composting"]

  subgraph cluster_ws {
    label="Water supply"
    wsa -> wst -> wsd [color="blue"]
  }

  wsd -> pop [color="blue"]
  pop -> ww  [color="blue:brown"]

  subgraph cluster_ww{
    label="Wastewater"
    ww  -> {unc col} [color="blue:brown"]
    unc -> {unt ons} [color="blue:brown"]
    col -> {unt wwt} [color="blue:brown"]
  }

  subgraph cluster_dis {
    label="Discharge"
    unt -> riv [color="blue:brown"]
    ons -> dis [color="blue"]
    wwt -> dis [color="blue"]
    dis -> riv [color="blue"]
    dis -> reu [color="blue"]
  }

  subgraph cluster_sm{
    label="Sludge management"
    {ons wwt} -> slu               [color="brown"]
    slu       -> {inc laf lap com} [color="brown"]
  }
}
